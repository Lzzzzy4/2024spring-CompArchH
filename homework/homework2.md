# 来泽远 PB21000164

## T1

### （1）

与写数据总线宽度相同，16字节

### （2）

64位即写一次8个字节。非合并则写一次占用一个缓冲区项目，合并则为两次。

将存储器置零大体指令如下
$$
\begin{align}
Loop: & ADD.W \space R1 \space \#8\\
& ST.W \space R0 \space R1\\
& SUB \space R2 \space R1 \space \#SIZE \\
& BNEQ \space R2 \space R0 \space Loop
\end{align}
$$
考虑并行发射则一次发射一个循环。故周期取决于ST使用的周期，即加速比为2。

### （3）

对于阻塞系统，当写miss时，会等待调块直至写完成，或者直接写内存，不需要太多的缓冲区项目。

对于非阻塞系统，可能会接受多个写miss，所以需要缓冲区项目足够存放若干请求。

## T2

### （1）非脏

1. 向L2申请，若在L2中命中则调入L1
2. 若在L2中Miss则向主存申请，并且存入L2和L1

### （2）非脏

1. 向L2申请，若在L2命中则将块调入L1并且在L2中将其无效
2. 若在L2中Miss则直接向主存申请，仅存入L1

### （3.1）脏

1. 向L2申请，若在L2中命中则调入L1，同时L1中的脏块写至L2（必定存在）
2. 若在L2中Miss则向主存申请，先调入L1，脏块写回L2；再调入L2，脏块写回主存，同时将L1中对应的部分（若存在）一并写回

### （3.2）脏

1. 向L2申请，若在L2命中则将块调入L1（连带dirty位）并且在L2中将其无效，L1中被替换的脏块直接写回主存
2. 若在L2中Miss则向主存申请，调入L1，被替换的脏块直接写回主存

## T3

需要考虑存入闪存和从闪存中搬运回主存的功耗，则空闲时间t为：
$$
t = \frac{(8G/64B)\times(2.56\times10^{-6}+0.5\times10^{-9})}{1.6} =200s
$$

## T4

### （1）

首先求出L2读32B的平均时间。
$$
\begin{align}
& t_{hit} = 15ns + \frac{256}{128} \times \frac{1}{266M}s = 22.5ns \\
& t_{miss} = 15ns + (60ns+\frac{512}{128}\times \frac{1}{133M}s) \times (1+50\%) +\frac{256}{128} \times \frac{1}{266M}s = 135+22.5 = 157.5ns \\
& t_{ave} = 22.5 + 0.2*135 = 49.5ns
\end{align}
$$
进而L1Icache平均读操作时间为
$$
t = 0.02 * 49.5 = 0.99ns
$$

### （2）

首先求出L2读16B的平均时间。
$$
\begin{align}
& t_{hit} = 15ns + \frac{128}{128} \times \frac{1}{266M}s = 18.75ns \\
& t_{miss} = 15ns + (60ns+\frac{512}{128}\times \frac{1}{133M}s) \times (1+50\%) +\frac{128}{128} \times \frac{1}{266M}s = (135+18.75)ns\\
& t_{ave} = 18.75 + 0.2*135 = 45.75ns
\end{align}
$$
同时，L2写16B的平均时间与读是相同的

进而L1Dcache平均读操作时间为
$$
t = 0.05 * 45.75 * (1+50\%)= 3.43ns
$$

### （3）

由于是直写缓存，是否命中都需要写L2。我们认为该处理器是32位的，一次写4B，先求出L2写4B的时间。
$$
\begin{align}
& t_{hit} = 15ns + \frac{32}{128} \times \frac{1}{266M}s = 15.9ns \\
& t_{miss} = (135+15.9)ns\\
& t_{ave} = 15.9 + 0.2*135 = 42.9ns
\end{align}
$$
命中时，L1Dcache写无代价，缺失时也不考虑调块。进而L1Dcache写操作平均时间为
$$
t = 42.9ns
$$
又由于写缓冲的存在，实际访问时间为
$$
t = 42.9*0.05 = 2.145ns
$$

### （4）

排除存储器访问的TPI为
$$
TPI = 1/1.1G = 0.9ns
$$
包括存储器在内的TPI为
$$
TPI = 0.9+0.99+20\% \times 3.43+5\% \times 2.145 = 2.68ns
$$
CPI为
$$
CPI = 2.68/0.9 = 2.98
$$
